<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Roll Hub</title>
<style>
  body {
    font-family: Arial, sans-serif;
    text-align: center;
    margin: 0;
    padding: 0;
    background: #f9fafb;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
  }
  
  main {
    flex: 1; /* takes remaining space so footer goes to bottom */
  }

  header {
    background: #111827;
    color: white;
    padding: 20px;
  }
  
  nav button {
    margin: 5px;
    padding: 10px 20px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
  }
  
  nav button.active {
    background: #2563eb;
    color: white;
  }
  
  section {
    display: none;
    padding: 20px;
  }
  section.active {
    display: block;
  }
  button.action {
    background: #2563eb;
    color: white;
    padding: 10px 20px;
    border: none;
    border-radius: 8px;
    margin: 10px;
    cursor: pointer;
    font-size: 16px;
  }
  
  .result {
    font-size: 24px;
    margin-top: 20px;
  }
  
  input {
    padding: 8px;
    width: 60%;
    border-radius: 6px;
    border: 1px solid #ccc;
  }

  #raceTrack {
    margin-top: 20px;
    position: relative;
    width: 70vw;
    max-width: 1000px;
    min-width: 360px;
    margin-left: auto;
    margin-right: auto;
    border: 2px solid #ccc;
    background: #f3f4f6;
    height: auto;
  }

  .lane {
    position: relative;
    height: 50px;
    border-bottom: 1px dashed #ccc;
    overflow: visible;
  }

  .duckContainer {
    position: absolute;
    display: flex;
    align-items: center;
    left: 0px;
    top: 50%;
    transform: translateY(-50%);
    transition: left 0.05s linear;
  }

  .duckContainer .duck {
    font-size: 28px;
    transform: scaleX(-1);
  }

  .duckName {
    position: absolute;
    right: 100%; /* float to left of duck */
    white-space: nowrap;
    margin-right: 10px;
    font-weight: bold;
  }

  .finish-line {
    position: absolute;
    right: 0;
    top: 0;
    height: 100%;
    width: 5px;
    background: red;
  }

  #coinContainer {
    margin-top: 20px;
    font-size: 50px;
    display: inline-block;
  }
  @keyframes spin {
    0% { transform: rotateY(0deg); }
    100% { transform: rotateY(720deg); }
  }
  .spin { animation: spin 2s linear; }

  footer {
    width: 100%;
    background: #111827;
    color: white;
    padding: 10px 0;
    font-size: 14px;
  }
</style>
</head>
<body>
<header>
  <h1>ðŸŽ² Foxseiz Roll Hub ðŸŽ²</h1>
  <nav>
    <button onclick="showTab('dice')" id="diceTab" class="active">Dice</button>
    <button onclick="showTab('coin')" id="coinTab">Coin</button>
    <button onclick="showTab('duck')" id="duckTab">Duck Race</button>
    <button onclick="showTab('teams')" id="teamsTab">Team Randomizer</button>
  </nav>
</header>

<main>
  <section id="dice" class="active">
    <h2>Dice Roller ðŸŽ²</h2>
    <button class="action" onclick="rollDice(6)">Roll a d6</button>
    <button class="action" onclick="rollDice(20)">Roll a d20</button>
    <button class="action" onclick="rollCustomDice()">Custom Dice</button>
    <br>
    <input type="number" id="customSides" placeholder="Enter sides (e.g. 10)">
    <div class="result" id="diceResult"></div>
  </section>
  
  <section id="coin">
    <h2>Coin Flip ðŸª™</h2>
    <button class="action" onclick="flipCoin()">Flip Coin</button>
    <div id="coinContainer">ðŸª™</div>
    <div class="result" id="coinResult"></div>
  </section>
  
  <section id="duck">
    <h2>Duck Race ðŸ¦†</h2>
    <input id="names" placeholder="Enter names separated by commas">
    <br>
    <input type="number" id="raceDuration" placeholder="Race duration in seconds" value="5">
    <br>
    <button class="action" onclick="startTimedDuckRace()">Start</button>
    <button class="action" onclick="resetDuckRace()">Reset</button>
    <div id="raceTrack"></div>
    <div class="result" id="duckResult"></div>
  </section>

  <section id="teams">
    <h2>Team Randomizer</h2>
    
    <h3>Leaders</h3>
    <input id="leadersInput" placeholder="Enter leaders separated by commas">
    
    <h3>Members</h3>
    <input id="membersInput" placeholder="Enter members separated by commas">
    
    <h3>Players per Team (optional)</h3>
    <input id="teamSizeInput" type="number" min="1" placeholder="Leave blank for auto-divide">
    
    <br><br>
    <button class="action" onclick="randomizeTeams()">Randomize Teams</button>
    
    <div class="result" id="teamResults"></div>
  </section>

</main>

<footer>
  Version 0.25
</footer>

<script>
let raceAnimation = null;
let racePlayers = [];

const duckColors = ["#f87171","#facc15","#34d399","#60a5fa","#a78bfa","#fb923c","#f472b6","#4ade80"];

function showTab(tab) {
  document.querySelectorAll('section').forEach(sec => sec.classList.remove('active'));
  document.querySelectorAll('nav button').forEach(btn => btn.classList.remove('active'));
  document.getElementById(tab).classList.add('active');
  document.getElementById(tab + 'Tab').classList.add('active');
}

function rollDice(sides) {
  const roll = Math.floor(Math.random() * sides) + 1;
  document.getElementById("diceResult").innerText = `You rolled: ${roll}`;
}

function rollCustomDice() {
  const sides = parseInt(document.getElementById("customSides").value);
  if (isNaN(sides) || sides < 2) {
    document.getElementById("diceResult").innerText = "Enter a valid number of sides (min 2).";
    return;
  }
  rollDice(sides);
}

function flipCoin() {
  const coinContainer = document.getElementById("coinContainer");
  const coinResult = document.getElementById("coinResult");
  coinResult.innerText = "";
  coinContainer.classList.add("spin");
  setTimeout(() => {
    coinContainer.classList.remove("spin");
    const flip = Math.random() < 0.5 ? "Heads" : "Tails";
    coinResult.innerText = `Coin landed on: ${flip}`;
  }, 2000);
}

function getRandomColor() {
  return duckColors[Math.floor(Math.random() * duckColors.length)];
}

function updateDuckPreview() {
  const input = document.getElementById("names").value;
  const players = input.split(",").map(p => p.trim()).filter(Boolean);
  const raceTrack = document.getElementById("raceTrack");
  raceTrack.innerHTML = "";

  if (players.length === 0) return;

  const finishLine = document.createElement("div");
  finishLine.className = "finish-line";
  raceTrack.appendChild(finishLine);

  players.forEach(player => {
    const lane = document.createElement("div");
    lane.className = "lane";

    const container = document.createElement("div");
    container.className = "duckContainer";
    container.style.left = "0px";

    const duck = document.createElement("div");
    duck.className = "duck";
    duck.innerText = "ðŸ¦†";

    const name = document.createElement("div");
    name.className = "duckName";
    name.innerText = player;
    name.style.color = getRandomColor();

    container.appendChild(duck);
    container.appendChild(name);
    lane.appendChild(container);
    raceTrack.appendChild(lane);
  });
}

document.getElementById("names").addEventListener("input", updateDuckPreview);
updateDuckPreview();

function startTimedDuckRace() {
  const input = document.getElementById("names").value;
  const players = input.split(",").map(p => p.trim()).filter(Boolean);
  const duration = parseFloat(document.getElementById("raceDuration").value);

  if (players.length < 2 || isNaN(duration) || duration <= 0) {
    document.getElementById("duckResult").innerText = "Add at least 2 names and valid duration!";
    return;
  }

  cancelAnimationFrame(raceAnimation);
  const raceTrack = document.getElementById("raceTrack");
  raceTrack.innerHTML = "";
  document.getElementById("duckResult").innerText = "";

  const trackWidth = raceTrack.clientWidth;
  const finishLineWidth = 5;

  const finishLine = document.createElement("div");
  finishLine.className = "finish-line";
  raceTrack.appendChild(finishLine);

  racePlayers = players.map(player => {
    const lane = document.createElement("div");
    lane.className = "lane";

    const container = document.createElement("div");
    container.className = "duckContainer";
    container.style.left = "0px";

    const duck = document.createElement("div");
    duck.className = "duck";
    duck.innerText = "ðŸ¦†";

    const name = document.createElement("div");
    name.className = "duckName";
    name.innerText = player;
    name.style.color = getRandomColor();

    container.appendChild(duck);
    container.appendChild(name);
    lane.appendChild(container);
    raceTrack.appendChild(lane);

    return {
      name,
      container,
      currentLeft: 0,
      baseSpeed: (trackWidth - finishLineWidth - 40) / (duration * 60),
      dynamicSpeed: 1 + Math.random() * 0.4
    };
  });

  let raceFinished = false;

  function animate() {
    if (raceFinished) return;
    let winner = null;

    racePlayers.forEach(p => {
      // random speed variation
      p.dynamicSpeed += (Math.random() - 0.5) * 0.02;
      p.dynamicSpeed = Math.max(0.5, Math.min(1.5, p.dynamicSpeed));

      p.currentLeft += p.baseSpeed * p.dynamicSpeed;
      const maxLeft = trackWidth - finishLineWidth - 40;

      if (p.currentLeft >= maxLeft && !winner) {
        p.currentLeft = maxLeft;
        winner = p.name.innerText;
        raceFinished = true;
      }

      p.container.style.left = p.currentLeft + "px";
    });

    if (winner) {
      document.getElementById("duckResult").innerText = "ðŸ† Winner is: " + winner + "!";
    } else {
      raceAnimation = requestAnimationFrame(animate);
    }
  }

  raceAnimation = requestAnimationFrame(animate);
}

  function resetDuckRace() {
    cancelAnimationFrame(raceAnimation);
    racePlayers.forEach(p => {
      p.currentLeft = 0;
      p.container.style.left = "0px";
    });
    document.getElementById("duckResult").innerText = "";
  }

  // Team Randomizer Script //
  function randomizeTeams() {
    const leaders = document.getElementById("leadersInput").value
      .split(",")
      .map(x => x.trim())
      .filter(Boolean);
  
    const members = document.getElementById("membersInput").value
      .split(",")
      .map(x => x.trim())
      .filter(Boolean);
  
    const teamSize = parseInt(document.getElementById("teamSizeInput").value);
  
    if (leaders.length < 1 || members.length < 1) {
      document.getElementById("teamResults").innerHTML =
        "Please enter at least 1 leader and 1 member.";
      return;
    }
  
    // Shuffle members for randomness
    const shuffled = members.sort(() => Math.random() - 0.5);
  
    // Prepare team containers
    const teams = {};
    const maxMembersPerTeam = {}; // includes leader in team size
    leaders.forEach(l => {
      teams[l] = [];
      maxMembersPerTeam[l] = isNaN(teamSize) ? Infinity : Math.max(0, teamSize - 1);
      // teamSize - 1 because the leader counts as 1
    });
  
    const undrafted = [];
  
    // --- Mode 1: User specified team size ---
    if (!isNaN(teamSize) && teamSize > 0) {
      let leaderIndex = 0;
  
      shuffled.forEach(member => {
        let assigned = false;
  
        // Try each leader until we find one with space
        for (let i = 0; i < leaders.length; i++) {
          const leader = leaders[(leaderIndex + i) % leaders.length];
  
          if (teams[leader].length < maxMembersPerTeam[leader]) {
            teams[leader].push(member);
            leaderIndex = (leaderIndex + i + 1) % leaders.length;
            assigned = true;
            break;
          }
        }
  
        if (!assigned) undrafted.push(member);
      });
  
    } else {
      // --- Mode 2: No team size â†’ even distribution ---
      let i = 0;
      shuffled.forEach(member => {
        const leader = leaders[i % leaders.length];
        teams[leader].push(member);
        i++;
      });
    }
  
    // Build output
    let output = "";
  
    leaders.forEach(leader => {
      output += `<strong>${leader}</strong> (Leader)<br>`;
      output += teams[leader].length
        ? teams[leader].join(", ") + "<br><br>"
        : "(No members)<br><br>";
    });
  
    // Show undrafted players (if any)
    if (undrafted.length > 0) {
      output += `<strong>Not in a team:</strong><br>${undrafted.join(", ")}`;
    }
  
    document.getElementById("teamResults").innerHTML = output;
  }

</script>
</body>
</html>
