<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Roll Hub</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin: 0; padding: 0; background: #f9fafb; }
    header { background: #111827; color: white; padding: 20px; }
    nav button { margin: 5px; padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; }
    nav button.active { background: #2563eb; color: white; }
    section { display: none; padding: 20px; }
    section.active { display: block; }
    button.action { background: #2563eb; color: white; padding: 10px 20px; border: none; border-radius: 8px; margin: 10px; cursor: pointer; font-size: 16px; }
    .result { font-size: 24px; margin-top: 20px; }
    input { padding: 8px; width: 60%; border-radius: 6px; border: 1px solid #ccc; }
    #raceTrack { margin-top: 20px; position: relative; width: 600px; margin-left: auto; margin-right: auto; border: 2px solid #ccc; background: #f3f4f6; }
    .lane { position: relative; height: 50px; border-bottom: 1px dashed #ccc; }
    .duck { position: absolute; left: 0; top: 5px; font-size: 28px; transition: left 0.1s linear; }
    .finish-line { position: absolute; right: 0; top: 0; height: 100%; width: 5px; background: red; }
  </style>
</head>
<body>
  <header>
    <h1>üé≤ Roll Hub üé≤</h1>
    <nav>
      <button onclick="showTab('dice')" id="diceTab" class="active">Dice</button>
      <button onclick="showTab('coin')" id="coinTab">Coin</button>
      <button onclick="showTab('duck')" id="duckTab">Duck Race</button>
    </nav>
  </header>

  <!-- Dice Section -->
  <section id="dice" class="active">
    <h2>Dice Roller üé≤</h2>
    <button class="action" onclick="rollDice(6)">Roll a d6</button>
    <button class="action" onclick="rollDice(20)">Roll a d20</button>
    <button class="action" onclick="rollCustomDice()">Custom Dice</button>
    <br>
    <input type="number" id="customSides" placeholder="Enter sides (e.g. 10)">
    <div class="result" id="diceResult"></div>
  </section>

  <!-- Coin Section -->
  <section id="coin">
    <h2>Coin Flip ü™ô</h2>
    <button class="action" onclick="flipCoin()">Flip Coin</button>
    <div class="result" id="coinResult"></div>
  </section>

  <!-- Duck Race Section -->
  <section id="duck">
    <h2>Duck Race ü¶Ü</h2>
    <input id="names" placeholder="Enter names separated by commas">
    <br>
    <input type="number" id="raceDuration" placeholder="Race duration in seconds" value="5">
    <br>
    <button class="action" onclick="startTimedDuckRace()">Start Timed Race</button>
    <div id="raceTrack"></div>
    <div class="result" id="duckResult"></div>
  </section>

  <script>
    function showTab(tab) {
      document.querySelectorAll('section').forEach(sec => sec.classList.remove('active'));
      document.querySelectorAll('nav button').forEach(btn => btn.classList.remove('active'));
      document.getElementById(tab).classList.add('active');
      document.getElementById(tab + 'Tab').classList.add('active');
    }

    function rollDice(sides) {
      const roll = Math.floor(Math.random() * sides) + 1;
      document.getElementById("diceResult").innerText = `You rolled: ${roll}`;
    }

    function rollCustomDice() {
      const sides = parseInt(document.getElementById("customSides").value);
      if (isNaN(sides) || sides < 2) {
        document.getElementById("diceResult").innerText = "Enter a valid number of sides (min 2).";
        return;
      }
      rollDice(sides);
    }

    function flipCoin() {
      const flip = Math.random() < 0.5 ? "Heads" : "Tails";
      document.getElementById("coinResult").innerText = `Coin landed on: ${flip}`;
    }

    function startTimedDuckRace() {
      const input = document.getElementById("names").value;
      const players = input.split(",").map(p => p.trim()).filter(Boolean);
      const duration = parseFloat(document.getElementById("raceDuration").value);

      if (players.length < 2 || isNaN(duration) || duration <= 0) {
        document.getElementById("duckResult").innerText = "Add at least 2 names and valid duration!";
        return;
      }

      const raceTrack = document.getElementById("raceTrack");
      raceTrack.innerHTML = "";
      document.getElementById("duckResult").innerText = "";

      const trackWidth = 600;
      const finishLineWidth = 5;
      const laneHeight = 50;

      // Add finish line
      const finishLine = document.createElement("div");
      finishLine.className = "finish-line";
      raceTrack.appendChild(finishLine);

      // Create lanes and ducks
      players.forEach((player, i) => {
        const lane = document.createElement("div");
        lane.className = "lane";
        lane.style.height = laneHeight + "px";

        const duck = document.createElement("div");
        duck.className = "duck";
        duck.innerText = "ü¶Ü " + player;
        duck.style.left = "0px";
        duck.id = "duck" + i;

        lane.appendChild(duck);
        raceTrack.appendChild(lane);
      });

      // Assign random speed multiplier for each duck
      const speeds = players.map(() => 0.8 + Math.random() * 0.4);

      const fps = 30;
      const intervalMs = 1000 / fps;
      const totalTicks = duration * fps;
      const stepPerTick = (trackWidth - finishLineWidth - 40) / totalTicks;
      let tickCount = 0;

      const raceInterval = setInterval(() => {
      let raceFinished = false;
    
      players.forEach((_, i) => {
        const duck = document.getElementById("duck" + i);
        const newPos = Math.min(
          parseFloat(duck.style.left) + stepPerTick * speeds[i],
          trackWidth - finishLineWidth - 40
        );
        duck.style.left = newPos + "px";
    
        // Declare winner immediately if a duck reaches finish line
        if (newPos >= trackWidth - finishLineWidth - 40 && !raceFinished) {
          raceFinished = true;
          clearInterval(raceInterval);
          document.getElementById("duckResult").innerText =
            "üèÜ Winner is: " + players[i] + "!";
        }
      });
    
      tickCount++;
      if (tickCount >= totalTicks && !raceFinished) {
        // If no duck reached finish, pick farthest
        let maxPos = 0;
        let winnerIndex = 0;
        players.forEach((_, i) => {
          const duck = document.getElementById("duck" + i);
          const pos = parseFloat(duck.style.left);
          if (pos > maxPos) {
            maxPos = pos;
            winnerIndex = i;
          }
        });
        document.getElementById("duckResult").innerText =
          "üèÜ Winner is: " + players[winnerIndex] + "!";
        clearInterval(raceInterval);
      }
    }, intervalMs);
    }
  </script>
</body>
</html>
